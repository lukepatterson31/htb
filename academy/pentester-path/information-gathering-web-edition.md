# Information Gathering - Web Edition

## Table of Contents
- [Introduction](#introduction)
    - [Types of Reconnaissance](#types-of-reconnaissance)
- [WHOIS](#whois)
    - [Utilising WHOIS](#utilising-whois)
- [DNS](#dns--subdomains)
    - [DNS Concepts](#dns-concepts)
    - [Record Types](#record-types)
    - [DNS Tools](#dns-tools)
    - [Subdomains](#subdomains)

## Introduction

The primary goals of web reconnaissance include:

- Identifying Assets: Uncovering all publicly accessible components of the target, such as web 
pages, subdomains, IP addresses, and technologies used. This step provides a comprehensive overview 
of the target's online presence.

- Discovering Hidden Information: Locating sensitive information that might be inadvertently 
exposed, including backup files, configuration files, or internal documentation. These findings can 
reveal valuable insights and potential entry points for attacks.

- Analysing the Attack Surface: Examining the target's attack surface to identify potential 
vulnerabilities and weaknesses. This involves assessing the technologies used, configurations, and 
possible entry points for exploitation.

- Gathering Intelligence: Collecting information that can be leveraged for further exploitation or 
social engineering attacks. This includes identifying key personnel, email addresses, or patterns 
of behaviour that could be exploited.

### Types of Reconnaissance

**Active Recon**

Direct interaction with the target  

| Technique | Description | Example | Tools | Risk of Detection |
|-----------|-------------|---------|-------|-------------------|
| Port Scanning | Identifying open ports and services running on the target. | Using Nmap to scan a web server for open ports like 80 (HTTP) and 443 (HTTPS). | Nmap, Masscan, Unicornscan | High: Direct interaction with the target can trigger intrusion detection systems (IDS) and firewalls. |
| Vulnerability Scanning | Probing the target for known vulnerabilities, such as outdated software or misconfigurations. | Running Nessus against a web application to check for SQL injection flaws or cross-site scripting (XSS) vulnerabilities. | Nessus, OpenVAS, Nikto | High: Vulnerability scanners send exploit payloads that security solutions can detect. |
| Network Mapping | Mapping the target's network topology, including connected devices and their relationships. | Using traceroute to determine the path packets take to reach the target server, revealing potential network hops and infrastructure. | Traceroute, Nmap | Medium to High: Excessive or unusual network traffic can raise suspicion. |
| Banner Grabbing | Retrieving information from banners displayed by services running on the target. | Connecting to a web server on port 80 and examining the HTTP banner to identify the web server software and version. | Netcat, curl | Low: Banner grabbing typically involves minimal interaction but can still be logged. |
| OS Fingerprinting | Identifying the operating system running on the target. | Using Nmap's OS detection capabilities (-O) to determine if the target is running Windows, Linux, or another OS. | Nmap, Xprobe2 | Low: OS fingerprinting is usually passive, but some advanced techniques can be detected. |
| Service Enumeration | Determining the specific versions of services running on open ports. | Using Nmap's service version detection (-sV) to determine if a web server is running Apache 2.4.50 or Nginx 1.18.0. | Nmap | Low: Similar to banner grabbing, service enumeration can be logged but is less likely to trigger alerts. |
| Web Spidering | Crawling the target website to identify web pages, directories, and files. | Running a web crawler like Burp Suite Spider or OWASP ZAP Spider to map out the structure of a website and discover hidden resources. | Burp Suite Spider, OWASP ZAP Spider, Scrapy (customisable) | Low to Medium: Can be detected if the crawler's behaviour is not carefully configured to mimic legitimate traffic. |

**Passive Recon**

No direct interaction with the target  

| Technique | Description | Example | Tools | Risk of Detection |
|-----------|-------------|---------|-------|-------------------|
| Search Engine Queries | Utilising search engines to uncover information about the target, including websites, social media profiles, and news articles. | Searching Google for "[Target Name] employees" to find employee information or social media profiles. | Google, DuckDuckGo, Bing, and specialised search engines (e.g., Shodan) | Very Low: Search engine queries are normal internet activity and unlikely to trigger alerts. |
| WHOIS Lookups | Querying WHOIS databases to retrieve domain registration details. | Performing a WHOIS lookup on a target domain to find the registrant's name, contact information, and name servers. | whois command-line tool, online WHOIS lookup services | Very Low: WHOIS queries are legitimate and do not raise suspicion. |
| DNS | Analysing DNS records to identify subdomains, mail servers, and other infrastructure. | Using dig to enumerate subdomains of a target domain. | dig, nslookup, host, dnsenum, fierce, dnsrecon | Very Low: DNS queries are essential for internet browsing and are not typically flagged as suspicious. |
| Web Archive Analysis | Examining historical snapshots of the target's website to identify changes, vulnerabilities, or hidden information. | Using the Wayback Machine to view past versions of a target website to see how it has changed over time. | Wayback Machine | Very Low: Accessing archived versions of websites is a normal activity. |
| Social Media Analysis | Gathering information from social media platforms like LinkedIn, Twitter, or Facebook. | Searching LinkedIn for employees of a target organisation to learn about their roles, responsibilities, and potential social engineering targets. | LinkedIn, Twitter, Facebook, specialised OSINT tools | Very Low: Accessing public social media profiles is not considered intrusive. |
| Code Repositories | Analysing publicly accessible code repositories like GitHub for exposed credentials or vulnerabilities. | Searching GitHub for code snippets or repositories related to the target that might contain sensitive information or code vulnerabilities. | GitHub, GitLab | Very Low: Code repositories are meant for public access, and searching them is not suspicious. |

## WHOIS

WHOIS is a widely used query and response protocol designed to access databases that store 
information about registered internet resources. Primarily associated with domain names, WHOIS can 
also provide details about IP address blocks and autonomous systems. Think of it as a giant 
phonebook for the internet, letting you look up who owns or is responsible for various online 
assets.

WHOIS records can help us by:

- Idenitfying key personnel: WHOIS records often reveal the names, email addresses and phone 
numbers for individuals responsible for managing the domain

- Discovering network infrastructure: Name servers and IP addresses provide clues about the 
target's network infrastructure

- Historical data analysis: Historical WHOIS records accessed through services like [WhoIsFreaks](https://whoisfreaks.com/)
can reveal changes in ownership, contact information or technical details over time

### Utilising WHOIS

```bash
whois domain.com
```

Key details:

1. Domain Registration
- Registrar
- Creation Date
- Expiry Date

2. Domain Owner
- Registrant/Admin/Tech Organization
- Registrant/Admin/Tech Contact

3. Domain Status
- [EPP codes](https://icann.org/epp) (clientDeleteProhibited etc.)

4. Name Servers

## DNS & Subdomains

### DNS Concepts

| DNS Concept | Description | Example |
|-------------|-------------|---------|
| Domain Name | A human-readable label for a website or other internet resource. | www.example.com |
| IP Address | A unique numerical identifier assigned to each device connected to the internet. | 192.0.2.1 |
| DNS Resolver | A server that translates domain names into IP addresses. | Your ISP's DNS server or public resolvers like Google DNS (8.8.8.8) |
| Root Name Server | The top-level servers in the DNS hierarchy. | There are 13 root servers worldwide, named A-M: a.root-servers.net |
| TLD Name Server | Servers responsible for specific top-level domains (e.g., .com, .org). | Verisign for .com, PIR for .org |
| Authoritative Name Server | The server that holds the actual IP address for a domain. | Often managed by hosting providers or domain registrars. |
| DNS Record Types | Different types of information stored in DNS. | A, AAAA, CNAME, MX, NS, TXT, etc. |

### Record Types

| Record Type | Full Name | Description | Zone File Example |
|-------------|-----------|-------------|-------------------|
| A | Address Record | Maps a hostname to its IPv4 address. | www.example.com. IN A 192.0.2.1 |
| AAAA | IPv6 Address Record | Maps a hostname to its IPv6 address. | www.example.com. IN AAAA 2001:db8:85a3::8a2e:370:7334 |
| CNAME | Canonical Name Record | Creates an alias for a hostname, pointing it to another hostname. | blog.example.com. IN CNAME webserver.example.net. |
| MX | Mail Exchange Record | Specifies the mail server(s) responsible for handling email for the domain. | example.com. IN MX 10 mail.example.com. |
| NS | Name Server Record | Delegates a DNS zone to a specific authoritative name server. | example.com. IN NS ns1.example.com. |
| TXT | Text Record | Stores arbitrary text information, often used for domain verification or security policies. | example.com. IN TXT "v=spf1 mx -all" (SPF record) |
| SOA | Start of Authority Record | Specifies administrative information about a DNS zone, including the primary name server, responsible person's email, and other parameters. | example.com. IN SOA ns1.example.com. admin.example.com. 2024060301 10800 3600 604800 86400 |
| SRV | Service Record | Defines the hostname and port number for specific services. | _sip._udp.example.com. IN SRV 10 5 5060 sipserver.example.com. |
| PTR | Pointer Record | Used for reverse DNS lookups, mapping an IP address to a hostname. | 1.2.0.192.in-addr.arpa. IN PTR www.example.com. |

`IN` is a class field that stands for "Internet", this indicates that the record applies to 
standard internet protocols we use today

**Why DNS matters for recon**

- Uncovering assets
- Mapping network infrastructure
- Monitoring for changes

### DNS Tools

| Tool | Key Features | Use Cases |
|------|--------------|-----------|
| `dig` | Versatile DNS lookup tool that supports various query types (A, MX, NS, TXT, etc.) and detailed output. | Manual DNS queries, zone transfers (if allowed), troubleshooting DNS issues, and in-depth analysis of DNS records. |
| `nslookup` | Simpler DNS lookup tool, primarily for A, AAAA, and MX records. | Basic DNS queries, quick checks of domain resolution and mail server records. |
| `host` | Streamlined DNS lookup tool with concise output. | Quick checks of A, AAAA, and MX records. |
| `dnsenum` | Automated DNS enumeration tool, dictionary attacks, brute-forcing, zone transfers (if allowed). | Discovering subdomains and gathering DNS information efficiently. |
| `fierce` | DNS reconnaissance and subdomain enumeration tool with recursive search and wildcard detection. | User-friendly interface for DNS reconnaissance, identifying subdomains and potential targets. |
| `dnsrecon` | Combines multiple DNS reconnaissance techniques and supports various output formats. | Comprehensive DNS enumeration, identifying subdomains, and gathering DNS records for further analysis. |
| `theHarvester` | OSINT tool that gathers information from various sources, including DNS records (email addresses). | Collecting email addresses, employee information, and other data associated with a domain from multiple sources. |
| `Online DNS Lookup Services` | User-friendly interfaces for performing DNS lookups. | Quick and easy DNS lookups, convenient when command-line tools are not available, checking for domain availability or basic information |

Common commands:

```bash
# default A record lookup for domain
dig domain.com

# Retrieve a specific record
# A     -> ipv4
# AAAA  -> ipv6
# MX    -> mail servers
# NS    -> name servers
# TXT   -> text records
# CNAME -> canonical name
# SOA   -> start of authority
dig domain.com AAAA

# Query a specific name server
dig @8.8.8.8 domain.com

# Show the full path of DNS resolution
dig +trace domain.com

# Reverse IP lookup (PTR record) may need a name server
dig -x 192.168.1.1

# Short form answer
dig +short domain.com

# Display only the answer section
dig +noall +answer domain.com

# Retrieve all available records (usually ignored to prevent abuse as per RFC 8482)
dig domain.com ANY
```

4 sections of output:

1. Header:  
DNS header flags `;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1`  
    - qr: Query Response
    - rd: Recusion Desired - Rescursion requested
    - ad: Authentic Data - Resolver considers the data authentic
    - QUERY/ANSWER/AUTHORITY/ADDITIONAL n: number n of entries for each section
    
2. Question section  
What is the A record (IP Address) for microsoft.com `;microsoft.com.                 IN      A`

3. Answer section  
Domain  TTL  Record  Answer: `microsoft.com.          2774    IN      A       13.107.246.64`

4. Footer  
    - Query time
    - SERVER - DNS server
    - WHEN - timestamp
    - MSG SIZE - size of DNS message in bytes

### Subdomains

