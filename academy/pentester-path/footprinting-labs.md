# Footprinting Labs

## Footprinting Lab - Easy

Test an internal DNS server belonging to Inlanefreight Ltd

Gather as much information as possible without using exploits

Team mates found the following credentials `ceil:qwer1234`

Employees were seen discussing SSH keys on a forum

### Enumeration

[nmap scan](./labs/footprinting-labs/easy/10.129.193.122.nmap)

**port 21 FTP**

nmap script scan shows dedicated subdomain for ftp server ftp.int.inlanefreight.htb

download ftp contents with:  
`wget -m --no-passive ftp://ceil:qwer1234@10.129.205.174`

nothing here

**port 22 SSH**

Public key authentication is required

**port 53**

ANY queries allowed

```bash
dig ANY inlanefreight.htb @10.129.205.174
```

AXFR also allowed, performed zone transfer to obtain the zone from the nameserver giving us 
information on multiple subdomains

```bash
dig AXFR inlanefreight.htb @10.129.205.174
```

AXFR query against the `internal` subdomain failed and ANY queries show no new information

we can also obtain the version of bind and the OS running on the target

```bash
dig CH TXT bind.version @10.129.205.174
```

**port 2121**

nmap script scan shows dedicated subdomain for ftp server ftp.int.inlanefreight.htb

download ftp contents with:  
`wget -m --no-passive ftp://ceil:qwer1234@10.129.205.174:2121`

ftp contents is ceil's home directory with ssh keys

### Exploitation

we can use the ssh key found in the second ftp server to connect to the target as ceil

```bash
# set correct access permissions on the key
chmod 600 id_rsa
# connect as ceil
ssh ceil@10.129.205.174 -i id_rsa
```

we can then search for the flag

```bash
find / -type f -name flag.txt 2>/dev/null
```

## Footprinting Lab - Medium

Server accessible by everyone on the internal network

Find as much information about the server as possible

User `HTB` was created and the password for that account is the flag

### Enumeration

**port 2049 NFS**

Listing the shares shows a mountable share `TechSupport`

```bash
showmount -e 10.129.202.41
```

Mount with

```bash
# make a local directory to mount the share
mkdir nfs
# mount the remote share
sudo mount -t nfs 10.129.202.41:/TechSupport ./nfs/ -o nolock
# share is owned by the nobody user so switch to root to access
sudo su
```

Found user credentials in a suport ticket in the share

**port 445 SMB**

The guest account is disabled and anonymous access is forbidden

Can list shares with credentials found in NFS share

Two shares are available: Users and devshare

devshare:

important.txt contains what looks like a username:password

Users:

The Users directory of the target is mounted as a share

We can only see one user alex who we have credentials for (Access-based enumeration setting)

alex's directory contains the other shares; TechSupport and devshare

**port 3389 RDP**

Can RDP with credentials found in the NFS share

```bash
xfreerdp3 /u:$user /p:$password 10.129.202.41
```

### Exploitation

Opening SQL Server Management shows the SQL Admin's username as sa which matches the 
username:password found in the devshare SMB share

Connecting to the Data Engine fails but the credentials are valid

Opening SQL Server Management as Administrator prompts us for a password and we discover 
password reuse for the local Administrator account

We can now access the accounts database and get the password for the HTB user

```sql
SELECT * FROM accounts.dbo.devsacc WHERE name = 'HTB';
```

## Footprinting Lab - Hard

MX and management server for the internal network

Also a backup server for all internal accounts in the domain

User `HTB` was created and the password for that account is the flag

### Enumeration

**port UDP/161 SNMP**

Brute force community strings with onesixtyone

```bash
onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt $target
```

Found community string `backup`

![backup](./labs/footprinting-labs/hard/img/community_string.png)

Found Admin username `tech@inlanefreight.com` with braa

```bash
braa backup@$target:.1.3.6.*
```

Found potential credentials for user `tom` with snmpwalk

```bash
snmpwalk -v2c -c backup $target
```
tom NMds732Js2761

**port TCP/22 SSH**

root access enabled

[ssh audit](./labs/footprinting-labs/hard/10.129.202.20.ssh_audit)

tom can only authenticate with a key

**port TCP/110 & 995 POP3**

tom's credentials work for 110

There's a message containing an ssh key from tech@inlanefreight.htb

![tom pop3](./labs/footprinting-labs/hard/img/tom_pop3.png)

**port TCP/143 & 993 IMAP**

tom's credentials work for 143

There's a message containing an ssh key from tech@inlanefreight.htb (same as POP3 inbox)

![tom imap](./labs/footprinting-labs/hard/img/tom_imap.png)
![ssh key imap](./labs/footprinting-labs/hard/img/ssh_key_imap.png)

### Exploitation

We can log in as tom using the ssh key we found in the dovecote POP3 or IMAP inbox

Listing tom's home directory shows the mailboxes for the IMAP and POP3 server

Tom's bash history shows he is a mysql user and his password works with mysql as well

We can dump the contents of the users table to get the HTB user's password